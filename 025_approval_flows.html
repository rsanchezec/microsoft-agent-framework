<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Completa: Flujos de Aprobaci√≥n Humana - 025_approval_flows.py</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #764ba2;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .intro-box {
            background: #f0f4ff;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .concept-box {
            background: #fff9e6;
            border: 2px solid #ffd700;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .concept-box h4 {
            color: #ff8c00;
            margin-bottom: 10px;
        }

        .example-box {
            background: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #ffebee;
            border-left: 5px solid #f44336;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .code-block {
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .code-block pre {
            margin: 0;
            padding: 20px;
            background: #2d2d2d;
            border-radius: 10px;
        }

        .code-block code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
        }

        .flow-diagram {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .comparison-table tr:hover {
            background: #e9ecef;
        }

        .step-by-step {
            counter-reset: step-counter;
        }

        .step {
            position: relative;
            padding-left: 60px;
            margin-bottom: 30px;
        }

        .step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .step h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .visual-flow {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .flow-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
            margin: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .flow-arrow {
            font-size: 2em;
            color: #667eea;
            margin: 0 10px;
        }

        .use-case {
            background: white;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .use-case h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 5px;
        }

        .badge-high {
            background: #ffebee;
            color: #c62828;
        }

        .badge-medium {
            background: #fff9e6;
            color: #f57c00;
        }

        .badge-low {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .toc h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            padding: 8px 0;
        }

        .toc a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .toc a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .visual-flow {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Gu√≠a Completa: Flujos de Aprobaci√≥n Humana</h1>
            <p>Entendiendo 025_approval_flows.py paso a paso</p>
        </div>

        <div class="content">
            <!-- Tabla de Contenidos -->
            <div class="toc">
                <h3>üìë Tabla de Contenidos</h3>
                <ul>
                    <li><a href="#intro">1. ¬øQu√© son los Flujos de Aprobaci√≥n?</a></li>
                    <li><a href="#why">2. ¬øPor qu√© son Importantes?</a></li>
                    <li><a href="#components">3. Componentes Principales</a></li>
                    <li><a href="#how-it-works">4. ¬øC√≥mo Funciona?</a></li>
                    <li><a href="#examples">5. Ejemplos Paso a Paso</a></li>
                    <li><a href="#patterns">6. Patrones de Aprobaci√≥n</a></li>
                    <li><a href="#use-cases">7. Casos de Uso Reales</a></li>
                    <li><a href="#best-practices">8. Mejores Pr√°cticas</a></li>
                </ul>
            </div>

            <!-- Secci√≥n 1: Introducci√≥n -->
            <div class="section" id="intro">
                <h2>1. ¬øQu√© son los Flujos de Aprobaci√≥n?</h2>

                <div class="intro-box">
                    <p><strong>En palabras simples:</strong> Los flujos de aprobaci√≥n son como un "sistema de confirmaci√≥n"
                    que le pregunta al usuario <strong>"¬øEst√°s seguro?"</strong> antes de hacer algo importante o peligroso.</p>
                </div>

                <h3>Analog√≠a del Mundo Real</h3>
                <p>Imagina que tienes un asistente robot que puede hacer tareas por ti:</p>

                <div class="visual-flow">
                    <div class="flow-box">
                        <strong>Tarea Simple</strong><br>
                        "Mu√©strame el clima"
                    </div>
                    <div class="flow-arrow">‚úì</div>
                    <div class="flow-box">
                        <strong>Ejecuta Directamente</strong><br>
                        No requiere confirmaci√≥n
                    </div>
                </div>

                <div class="visual-flow" style="margin-top: 20px;">
                    <div class="flow-box" style="background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);">
                        <strong>Tarea Peligrosa</strong><br>
                        "Elimina todos mis archivos"
                    </div>
                    <div class="flow-arrow">‚ö†Ô∏è</div>
                    <div class="flow-box" style="background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);">
                        <strong>ESPERA...</strong><br>
                        ¬øEst√°s seguro?
                    </div>
                    <div class="flow-arrow">üë§</div>
                    <div class="flow-box">
                        <strong>Usuario Decide</strong><br>
                        S√≠ o No
                    </div>
                </div>

                <p style="margin-top: 20px;">Los flujos de aprobaci√≥n son ese paso de <span class="highlight">"¬øEst√°s seguro?"</span>
                que previene errores costosos o peligrosos.</p>
            </div>

            <!-- Secci√≥n 2: Por qu√© son importantes -->
            <div class="section" id="why">
                <h2>2. ¬øPor qu√© son Importantes?</h2>

                <div class="concept-box">
                    <h4>üéØ Raz√≥n Principal: Prevenir Errores Costosos</h4>
                    <p>Imagina que un agente de IA puede:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>‚ùå Eliminar usuarios de una base de datos</li>
                        <li>üí∞ Transferir dinero entre cuentas</li>
                        <li>üìß Enviar emails a miles de personas</li>
                        <li>üóëÔ∏è Borrar archivos importantes</li>
                        <li>‚òÅÔ∏è Hacer cambios en servidores de producci√≥n</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>Sin aprobaci√≥n:</strong> Un error del agente podr√≠a ser desastroso.</p>
                    <p><strong>Con aprobaci√≥n:</strong> El humano revisa y confirma antes de que suceda.</p>
                </div>

                <h3>Ejemplos del Mundo Real</h3>

                <div class="use-case">
                    <h4>üè¶ Ejemplo 1: Transferencia de Dinero</h4>
                    <p><strong>Sin Aprobaci√≥n:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-none">Usuario: "Transfiere $5000 a la cuenta 123"
Agente: "Transferencia completada ‚úì"
// ¬°Error! Se transfiri√≥ a la cuenta equivocada</code></pre>
                    </div>
                    <p><strong>Con Aprobaci√≥n:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-none">Usuario: "Transfiere $5000 a la cuenta 123"
Agente: "‚ö†Ô∏è CONFIRMACION REQUERIDA
         - Transferir: $5000
         - De: Cuenta A
         - A: Cuenta 123
         ¬øAprobar? (S√≠/No)"
Usuario: *revisa* "Espera, esa no es la cuenta correcta. NO"
Agente: "Transferencia cancelada"
// ¬°Desastre evitado! ‚úì</code></pre>
                    </div>
                </div>

                <div class="use-case">
                    <h4>üóëÔ∏è Ejemplo 2: Eliminar Usuario</h4>
                    <p><strong>Escenario:</strong> Un administrador le pide al agente eliminar un usuario de prueba.</p>
                    <div class="code-block">
                        <pre><code class="language-none">Usuario: "Elimina el usuario juan_test"
Agente: // El agente entendi√≥ mal y va a eliminar "juan" (usuario real)
Agente: "‚ö†Ô∏è CONFIRMACION REQUERIDA
         Operaci√≥n DESTRUCTIVA
         - Usuario a eliminar: juan
         - √öltima conexi√≥n: Hoy
         - Archivos asociados: 1,234
         ¬øAprobar? (S√≠/No)"
Usuario: "¬°NO! Ese no es el usuario correcto"
// ¬°Crisis evitada!</code></pre>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Componentes Principales -->
            <div class="section" id="components">
                <h2>3. Componentes Principales del Script</h2>

                <p>El script 025_approval_flows.py tiene 3 componentes principales:</p>

                <div class="step-by-step">
                    <div class="step">
                        <h4>ApprovalRequest (Solicitud de Aprobaci√≥n)</h4>
                        <p>Es como un <strong>"formulario"</strong> que contiene toda la informaci√≥n de la operaci√≥n que necesita aprobaci√≥n:</p>
                        <div class="code-block">
                            <pre><code class="language-python">class ApprovalRequest:
    tool_name = "delete_user"        # ¬øQu√© quiere hacer?
    arguments = {"user_id": "123"}  # ¬øCon qu√© datos?
    description = "Eliminar usuario" # Descripci√≥n clara
    risk_level = "high"             # ¬øQu√© tan peligroso?
    timestamp = "2024-01-15 10:30"   # ¬øCu√°ndo?</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <h4>ApprovalManager (Gestor de Aprobaciones)</h4>
                        <p>Es el <strong>"controlador central"</strong> que:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üìù Crea solicitudes de aprobaci√≥n</li>
                            <li>‚è∏Ô∏è Pausa la ejecuci√≥n</li>
                            <li>‚ùì Pregunta al usuario</li>
                            <li>üìä Registra todas las decisiones (auditor√≠a)</li>
                            <li>‚úÖ/‚ùå Ejecuta o cancela seg√∫n la respuesta</li>
                        </ul>
                    </div>

                    <div class="step">
                        <h4>ApprovalDecision (Decisi√≥n)</h4>
                        <p>La respuesta del usuario. Puede ser:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚úÖ <strong>APPROVED</strong> - "S√≠, adelante"</li>
                            <li>‚ùå <strong>REJECTED</strong> - "No, cancela"</li>
                            <li>‚è±Ô∏è <strong>TIMEOUT</strong> - El usuario no respondi√≥ a tiempo</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 4: C√≥mo Funciona -->
            <div class="section" id="how-it-works">
                <h2>4. ¬øC√≥mo Funciona? - Flujo Completo</h2>

                <div class="flow-diagram">
                    <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">
                        Flujo de una Operaci√≥n con Aprobaci√≥n
                    </h3>
                    <div class="mermaid">
graph TD
    A[üë§ Usuario: Elimina el usuario 123] --> B{¬øRequiere aprobaci√≥n?}
    B -->|No requiere| C[‚úì Ejecutar directamente]
    B -->|S√≠ requiere| D[‚ö†Ô∏è Crear ApprovalRequest]
    D --> E[üìù Mostrar detalles al usuario]
    E --> F{üë§ Usuario decide}
    F -->|‚úÖ Aprobar| G[Ejecutar operaci√≥n]
    F -->|‚ùå Rechazar| H[Cancelar operaci√≥n]
    F -->|‚è±Ô∏è Timeout| H
    G --> I[üìä Registrar en auditor√≠a]
    H --> I
    I --> J[Retornar resultado]
                    </div>
                </div>

                <h3>Paso a Paso con C√≥digo</h3>

                <div class="step-by-step">
                    <div class="step">
                        <h4>El usuario hace una petici√≥n</h4>
                        <div class="code-block">
                            <pre><code class="language-python"># El usuario quiere eliminar un usuario
result = await delete_user_with_approval("user_12345")</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <h4>Se crea una solicitud de aprobaci√≥n</h4>
                        <div class="code-block">
                            <pre><code class="language-python"># Dentro de la funci√≥n delete_user_with_approval:
request = approval_manager.create_request(
    tool_name="delete_user",
    arguments={"user_id": "user_12345"},
    description="Eliminar usuario user_12345 del sistema",
    risk_level="high"  # Alto riesgo = siempre requiere aprobaci√≥n
)</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <h4>Se solicita aprobaci√≥n al usuario</h4>
                        <div class="code-block">
                            <pre><code class="language-python"># El sistema muestra esto al usuario:
‚ö†Ô∏è APROBACION REQUERIDA
Herramienta: delete_user
Argumentos: {'user_id': 'user_12345'}
Descripcion: Eliminar usuario user_12345 del sistema
Nivel de riesgo: high
Timeout: 30s

# Espera la decisi√≥n del usuario...
decision = await approval_manager.request_approval(request)</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <h4>Se ejecuta o cancela seg√∫n la decisi√≥n</h4>
                        <div class="code-block">
                            <pre><code class="language-python">if decision == ApprovalDecision.APPROVED:
    # Usuario dijo "S√≠" - ejecutar la operaci√≥n
    return delete_user(user_id)
else:
    # Usuario dijo "No" o timeout - cancelar
    return {
        "success": False,
        "error": "Operaci√≥n rechazada"
    }</code></pre>
                        </div>
                    </div>

                    <div class="step">
                        <h4>Se registra en el historial (auditor√≠a)</h4>
                        <div class="code-block">
                            <pre><code class="language-python"># Autom√°ticamente se guarda:
{
    "timestamp": "2024-01-15 10:30:00",
    "tool_name": "delete_user",
    "arguments": {"user_id": "user_12345"},
    "risk_level": "high",
    "decision": "approved",  // o "rejected"
    "approved_by": "admin_user"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 5: Ejemplos Paso a Paso -->
            <div class="section" id="examples">
                <h2>5. Ejemplos Paso a Paso</h2>

                <h3>Ejemplo 1: Aprobaci√≥n Siempre Requerida</h3>
                <div class="example-box">
                    <p><strong>Escenario:</strong> Eliminar un usuario (operaci√≥n destructiva)</p>

                    <p><strong>C√≥digo:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-python">async def delete_user_with_approval(user_id):
    # 1. Crear solicitud
    request = approval_manager.create_request(
        tool_name="delete_user",
        arguments={"user_id": user_id},
        description=f"Eliminar usuario {user_id}",
        risk_level="high"  # SIEMPRE requiere aprobaci√≥n
    )

    # 2. Pedir aprobaci√≥n
    decision = await approval_manager.request_approval(request)

    # 3. Ejecutar o cancelar
    if decision == ApprovalDecision.APPROVED:
        return delete_user(user_id)  # ‚úì Ejecutar
    else:
        return {"error": "Rechazado"}       # ‚úó Cancelar</code></pre>
                    </div>

                    <p><strong>Flujo:</strong></p>
                    <div class="visual-flow">
                        <div class="flow-box">Usuario pide<br>eliminar</div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box" style="background: #ff9800;">PAUSA<br>Pregunta</div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box">Usuario<br>aprueba/rechaza</div>
                        <div class="flow-arrow">‚Üí</div>
                        <div class="flow-box">Ejecuta o<br>cancela</div>
                    </div>
                </div>

                <h3>Ejemplo 2: Aprobaci√≥n Condicional</h3>
                <div class="example-box">
                    <p><strong>Escenario:</strong> Transferencia de dinero (solo montos grandes requieren aprobaci√≥n)</p>

                    <p><strong>L√≥gica:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>üí∞ Monto ‚â§ $100 ‚Üí <span class="badge badge-low">AUTO-APROBADO</span></li>
                        <li>üí∞ Monto > $100 y ‚â§ $1000 ‚Üí <span class="badge badge-medium">REQUIERE APROBACI√ìN</span></li>
                        <li>üí∞ Monto > $1000 ‚Üí <span class="badge badge-high">REQUIERE APROBACI√ìN CR√çTICA</span></li>
                    </ul>

                    <p><strong>C√≥digo:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-python">async def transfer_money_conditional(from_account, to_account, amount):
    # 1. Determinar si requiere aprobaci√≥n
    requires_approval = amount > 100

    if not requires_approval:
        # Monto peque√±o - ejecutar directamente
        return execute_transfer(from_account, to_account, amount)

    # 2. Determinar nivel de riesgo
    risk_level = "high" if amount > 1000 else "medium"

    # 3. Crear solicitud
    request = approval_manager.create_request(
        tool_name="transfer_money",
        arguments={"amount": amount},
        risk_level=risk_level
    )

    # 4. Pedir aprobaci√≥n
    decision = await approval_manager.request_approval(request)

    # 5. Ejecutar o cancelar
    if decision == ApprovalDecision.APPROVED:
        return execute_transfer(from_account, to_account, amount)
    else:
        return {"error": "Transferencia rechazada"}</code></pre>
                    </div>

                    <p><strong>Ejemplos de uso:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-python"># Caso 1: Monto peque√±o ($50)
result = await transfer_money_conditional("ACC1", "ACC2", 50)
# ‚úì Se ejecuta inmediatamente (no requiere aprobaci√≥n)

# Caso 2: Monto mediano ($500)
result = await transfer_money_conditional("ACC1", "ACC2", 500)
# ‚ö†Ô∏è Requiere aprobaci√≥n (riesgo medio)

# Caso 3: Monto grande ($5000)
result = await transfer_money_conditional("ACC1", "ACC2", 5000)
# ‚ö†Ô∏è‚ö†Ô∏è Requiere aprobaci√≥n CR√çTICA (riesgo alto)</code></pre>
                    </div>
                </div>

                <h3>Ejemplo 3: Decorador Reutilizable</h3>
                <div class="example-box">
                    <p><strong>Problema:</strong> ¬øC√≥mo agregar aprobaci√≥n a m√∫ltiples funciones sin repetir c√≥digo?</p>
                    <p><strong>Soluci√≥n:</strong> Un decorador que se puede aplicar a cualquier funci√≥n</p>

                    <div class="code-block">
                        <pre><code class="language-python"># 1. Definir el decorador
def require_approval(risk_level="medium", timeout=30.0):
    def decorator(func):
        async def wrapper(*args, **kwargs):
            # Crear solicitud autom√°ticamente
            request = approval_manager.create_request(
                tool_name=func.__name__,
                risk_level=risk_level
            )

            # Pedir aprobaci√≥n
            decision = await approval_manager.request_approval(request)

            # Ejecutar si aprobado
            if decision == ApprovalDecision.APPROVED:
                return await func(*args, **kwargs)
            else:
                return {"error": "Rechazado"}
        return wrapper
    return decorator

# 2. Usar el decorador (¬°super f√°cil!)
@require_approval(risk_level="high")
def send_email_to_all_users(subject, body):
    # Esta funci√≥n ahora requiere aprobaci√≥n autom√°ticamente
    return send_emails(subject, body)

# 3. Al llamarla, autom√°ticamente pide aprobaci√≥n
result = await send_email_to_all_users(
    "Importante",
    "Mensaje a todos"
)
# ‚ö†Ô∏è El decorador intercepta y pide aprobaci√≥n antes de enviar</code></pre>
                    </div>

                    <p><strong>Ventajas del decorador:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>‚úÖ C√≥digo reutilizable</li>
                        <li>‚úÖ F√°cil de aplicar a m√∫ltiples funciones</li>
                        <li>‚úÖ No repites el c√≥digo de aprobaci√≥n</li>
                        <li>‚úÖ Solo agregas una l√≠nea: <code>@require_approval(...)</code></li>
                    </ul>
                </div>
            </div>

            <!-- Secci√≥n 6: Patrones de Aprobaci√≥n -->
            <div class="section" id="patterns">
                <h2>6. Patrones de Aprobaci√≥n</h2>

                <p>El script implementa varios patrones. Aqu√≠ est√° cu√°ndo usar cada uno:</p>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Patr√≥n</th>
                            <th>Cu√°ndo Usar</th>
                            <th>Ejemplo</th>
                            <th>Nivel de Riesgo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Always Require</strong><br>(Siempre requerir)</td>
                            <td>Operaciones destructivas o irreversibles</td>
                            <td>Eliminar usuarios, borrar bases de datos, enviar emails masivos</td>
                            <td><span class="badge badge-high">ALTO</span></td>
                        </tr>
                        <tr>
                            <td><strong>Never Require</strong><br>(Nunca requerir)</td>
                            <td>Operaciones seguras, solo lectura</td>
                            <td>Consultar datos, listar usuarios, ver estad√≠sticas</td>
                            <td><span class="badge badge-low">BAJO</span></td>
                        </tr>
                        <tr>
                            <td><strong>Condicional (Monto)</strong></td>
                            <td>Basado en un valor num√©rico</td>
                            <td>Transferencias > $100, compras > $500</td>
                            <td><span class="badge badge-medium">MEDIO/ALTO</span></td>
                        </tr>
                        <tr>
                            <td><strong>Condicional (Tama√±o)</strong></td>
                            <td>Basado en tama√±o o cantidad</td>
                            <td>Archivos > 1GB, emails a > 100 personas</td>
                            <td><span class="badge badge-medium">MEDIO</span></td>
                        </tr>
                        <tr>
                            <td><strong>Workflow Multi-Punto</strong></td>
                            <td>Procesos con varios pasos cr√≠ticos</td>
                            <td>Deploy a producci√≥n, procesamiento de n√≥mina</td>
                            <td><span class="badge badge-high">ALTO</span></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Workflow con M√∫ltiples Puntos de Aprobaci√≥n</h3>
                <div class="example-box">
                    <p><strong>Escenario:</strong> Deploy a producci√≥n (proceso con 4 pasos, 2 requieren aprobaci√≥n)</p>

                    <div class="flow-diagram">
                        <div class="mermaid">
graph LR
    A[1. Tests] -->|Auto| B[2. Build]
    B -->|‚ö†Ô∏è Aprobaci√≥n 1| C[3. Deploy]
    C -->|‚ö†Ô∏è Aprobaci√≥n 2| D[4. Notificar]
    D --> E[‚úì Completado]
                        </div>
                    </div>

                    <p><strong>C√≥digo simplificado:</strong></p>
                    <div class="code-block">
                        <pre><code class="language-python">async def deploy_to_production_workflow():
    # Paso 1: Tests (no requiere aprobaci√≥n)
    run_tests()

    # Paso 2: Build (requiere aprobaci√≥n - riesgo medio)
    decision = await request_approval("build_production", "medium")
    if decision != APPROVED:
        return {"error": "Build rechazado"}
    build_production()

    # Paso 3: Deploy (requiere aprobaci√≥n - riesgo alto)
    decision = await request_approval("deploy_production", "high")
    if decision != APPROVED:
        return {"error": "Deploy rechazado"}
    deploy_production()

    # Paso 4: Notificar (no requiere aprobaci√≥n)
    notify_team()

    return {"success": True}</code></pre>
                    </div>

                    <p><strong>Ventaja:</strong> Si cualquier aprobaci√≥n es rechazada, el workflow se detiene inmediatamente, previniendo despliegues no autorizados.</p>
                </div>
            </div>

            <!-- Secci√≥n 7: Casos de Uso Reales -->
            <div class="section" id="use-cases">
                <h2>7. Casos de Uso Reales</h2>

                <h3>¬øCu√°ndo necesitas aprobaciones en el mundo real?</h3>

                <div class="use-case">
                    <h4>üè¶ 1. Operaciones Financieras</h4>
                    <p><strong>Operaciones que requieren aprobaci√≥n:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Transferencias bancarias > umbral</li>
                        <li>Pagos a proveedores</li>
                        <li>Reembolsos a clientes</li>
                        <li>Cambios de configuraci√≥n de pagos</li>
                    </ul>
                    <p><strong>¬øPor qu√©?</strong> Un error puede costar miles de d√≥lares y es dif√≠cil de revertir.</p>
                </div>

                <div class="use-case">
                    <h4>üë• 2. Gesti√≥n de Usuarios</h4>
                    <p><strong>Operaciones que requieren aprobaci√≥n:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Eliminar usuarios</li>
                        <li>Cambiar roles/permisos</li>
                        <li>Desactivar cuentas de administrador</li>
                        <li>Modificar datos sensibles</li>
                    </ul>
                    <p><strong>¬øPor qu√©?</strong> Afecta a personas reales y puede causar problemas de seguridad o acceso.</p>
                </div>

                <div class="use-case">
                    <h4>‚òÅÔ∏è 3. Infraestructura y Deploy</h4>
                    <p><strong>Operaciones que requieren aprobaci√≥n:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Deploy a producci√≥n</li>
                        <li>Cambios de configuraci√≥n en servidores</li>
                        <li>Escalado de recursos (que cuesta dinero)</li>
                        <li>Modificaci√≥n de bases de datos de producci√≥n</li>
                    </ul>
                    <p><strong>¬øPor qu√©?</strong> Un error puede tirar el servicio completo y afectar a miles de usuarios.</p>
                </div>

                <div class="use-case">
                    <h4>üìß 4. Comunicaciones Masivas</h4>
                    <p><strong>Operaciones que requieren aprobaci√≥n:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Emails a todos los usuarios</li>
                        <li>Notificaciones push masivas</li>
                        <li>SMS a clientes</li>
                        <li>Publicaciones en redes sociales de la empresa</li>
                    </ul>
                    <p><strong>¬øPor qu√©?</strong> Un mensaje equivocado puede da√±ar la reputaci√≥n de la empresa y molestar a usuarios.</p>
                </div>

                <div class="use-case">
                    <h4>üìä 5. Datos Sensibles</h4>
                    <p><strong>Operaciones que requieren aprobaci√≥n:</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>Eliminar datos masivamente</li>
                        <li>Exportar datos personales (GDPR/privacidad)</li>
                        <li>Cambios masivos en bases de datos</li>
                        <li>Acceso a logs de auditor√≠a</li>
                    </ul>
                    <p><strong>¬øPor qu√©?</strong> Requisitos legales (GDPR, HIPAA) y protecci√≥n de privacidad.</p>
                </div>
            </div>

            <!-- Secci√≥n 8: Mejores Pr√°cticas -->
            <div class="section" id="best-practices">
                <h2>8. Mejores Pr√°cticas</h2>

                <h3>‚úÖ Qu√© S√ç hacer</h3>

                <div class="example-box">
                    <h4>1. Clasificar Operaciones por Nivel de Riesgo</h4>
                    <p>Define niveles claros:</p>
                    <ul style="margin-left: 20px;">
                        <li><span class="badge badge-low">LOW</span> - Solo lectura, sin efectos secundarios</li>
                        <li><span class="badge badge-medium">MEDIUM</span> - Cambios reversibles, impacto limitado</li>
                        <li><span class="badge badge-high">HIGH</span> - Irreversible, destructivo, o costoso</li>
                        <li><span class="badge badge-high">CRITICAL</span> - Puede tirar el servicio o causar p√©rdidas grandes</li>
                    </ul>
                </div>

                <div class="example-box">
                    <h4>2. Usar Timeouts Apropiados</h4>
                    <div class="code-block">
                        <pre><code class="language-python"># Operaciones est√°ndar: 30 segundos
timeout = 30.0

# Operaciones cr√≠ticas: 60-120 segundos (m√°s tiempo para revisar)
timeout = 60.0

# Si timeout, rechazar por defecto (m√°s seguro)
if timeout_occurred:
    decision = ApprovalDecision.REJECTED</code></pre>
                    </div>
                </div>

                <div class="example-box">
                    <h4>3. Proporcionar Contexto Rico</h4>
                    <p>El usuario debe entender EXACTAMENTE qu√© est√° aprobando:</p>
                    <div class="code-block">
                        <pre><code class="language-python"># ‚ùå MAL - Contexto pobre
"¬øAprobar operaci√≥n?"

# ‚úÖ BIEN - Contexto rico
"""
‚ö†Ô∏è APROBACION REQUERIDA
Operaci√≥n: Eliminar usuario
Usuario: john_doe (ID: 12345)
√öltima conexi√≥n: 2024-01-10
Archivos asociados: 1,234
Proyectos activos: 3

¬øAprobar esta operaci√≥n IRREVERSIBLE?
"""</code></pre>
                    </div>
                </div>

                <div class="example-box">
                    <h4>4. Registrar TODO en Auditor√≠a</h4>
                    <p>Cada decisi√≥n debe quedar registrada:</p>
                    <div class="code-block">
                        <pre><code class="language-python">{
    "timestamp": "2024-01-15 10:30:00",
    "operation": "delete_user",
    "user_id": "12345",
    "approved_by": "admin@company.com",
    "decision": "approved",
    "risk_level": "high",
    "ip_address": "192.168.1.100"
}</code></pre>
                    </div>
                    <p><strong>¬øPor qu√©?</strong> Para compliance, seguridad, y poder investigar incidentes.</p>
                </div>

                <h3>‚ùå Qu√© NO hacer</h3>

                <div class="warning-box">
                    <h4>1. No Requerir Aprobaci√≥n para TODO</h4>
                    <p><strong>Problema:</strong> "Fatiga de aprobaciones" - el usuario aprueba sin leer</p>
                    <p><strong>Soluci√≥n:</strong> Solo operaciones realmente sensibles/destructivas</p>
                    <div class="code-block">
                        <pre><code class="language-python"># ‚ùå MAL - Requiere aprobaci√≥n para leer datos (innecesario)
@require_approval(risk_level="high")
def get_user_profile(user_id):
    return database.get(user_id)

# ‚úÖ BIEN - Solo lectura, no requiere aprobaci√≥n
def get_user_profile(user_id):
    return database.get(user_id)</code></pre>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>2. No Usar Aprobaciones Sin Timeout</h4>
                    <p><strong>Problema:</strong> Operaci√≥n queda en limbo indefinidamente</p>
                    <div class="code-block">
                        <pre><code class="language-python"># ‚ùå MAL - Sin timeout
decision = await request_approval(request)  # Espera infinito

# ‚úÖ BIEN - Con timeout y fallback
decision = await request_approval(request, timeout=30.0)
if decision == ApprovalDecision.TIMEOUT:
    # Rechazar por defecto (m√°s seguro)
    decision = ApprovalDecision.REJECTED</code></pre>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>3. No Aprobar Operaciones Sin Validar Primero</h4>
                    <p><strong>Problema:</strong> Pedir aprobaci√≥n para una operaci√≥n inv√°lida</p>
                    <div class="code-block">
                        <pre><code class="language-python"># ‚ùå MAL - Pide aprobaci√≥n sin validar
async def delete_user(user_id):
    decision = await request_approval(...)  # user_id puede no existir
    database.delete(user_id)  # Falla aqu√≠

# ‚úÖ BIEN - Validar ANTES de pedir aprobaci√≥n
async def delete_user(user_id):
    if not database.exists(user_id):
        return {"error": "Usuario no existe"}  # No pedir aprobaci√≥n

    decision = await request_approval(...)  # Solo si es v√°lido
    if approved:
        database.delete(user_id)</code></pre>
                    </div>
                </div>

                <h3>üéØ Resumen de Mejores Pr√°cticas</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Pr√°ctica</th>
                            <th>Descripci√≥n</th>
                            <th>Beneficio</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Clasificaci√≥n de riesgo</td>
                            <td>Usar niveles: low, medium, high, critical</td>
                            <td>Claridad en qu√© requiere aprobaci√≥n</td>
                        </tr>
                        <tr>
                            <td>Timeouts apropiados</td>
                            <td>30-60s est√°ndar, 60-120s cr√≠tico</td>
                            <td>No dejar operaciones en limbo</td>
                        </tr>
                        <tr>
                            <td>Contexto rico</td>
                            <td>Mostrar detalles completos de la operaci√≥n</td>
                            <td>Usuario puede tomar decisi√≥n informada</td>
                        </tr>
                        <tr>
                            <td>Auditor√≠a completa</td>
                            <td>Registrar todas las decisiones</td>
                            <td>Compliance, seguridad, investigaci√≥n</td>
                        </tr>
                        <tr>
                            <td>Validar antes de aprobar</td>
                            <td>Verificar operaci√≥n es v√°lida primero</td>
                            <td>No desperdiciar tiempo en aprobaciones in√∫tiles</td>
                        </tr>
                        <tr>
                            <td>Granularidad apropiada</td>
                            <td>No requerir aprobaci√≥n para TODO</td>
                            <td>Evitar fatiga de aprobaciones</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Conclusi√≥n -->
            <div class="section">
                <h2>üéì Conclusi√≥n</h2>

                <div class="intro-box">
                    <h3>Resumen Final</h3>
                    <p><strong>¬øQu√© son los flujos de aprobaci√≥n?</strong></p>
                    <p>Un sistema de "confirmaci√≥n humana" que pregunta "¬øEst√°s seguro?" antes de ejecutar operaciones sensibles, destructivas o costosas.</p>

                    <p style="margin-top: 20px;"><strong>¬øPor qu√© son importantes?</strong></p>
                    <p>Previenen errores costosos, cumplen requisitos legales, y agregan una capa de seguridad cr√≠tica.</p>

                    <p style="margin-top: 20px;"><strong>¬øC√≥mo funcionan?</strong></p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Usuario solicita una operaci√≥n</li>
                        <li>Sistema determina si requiere aprobaci√≥n</li>
                        <li>Si requiere, pausa y pregunta al usuario</li>
                        <li>Usuario aprueba o rechaza</li>
                        <li>Sistema ejecuta o cancela seg√∫n la decisi√≥n</li>
                        <li>Todo queda registrado en auditor√≠a</li>
                    </ol>

                    <p style="margin-top: 20px;"><strong>¬øCu√°ndo usar?</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>‚úÖ Operaciones destructivas (eliminar, borrar)</li>
                        <li>‚úÖ Operaciones financieras (transferencias, pagos)</li>
                        <li>‚úÖ Cambios de infraestructura (deploy, config)</li>
                        <li>‚úÖ Comunicaciones masivas (emails, SMS)</li>
                        <li>‚úÖ Datos sensibles (exportar, modificar)</li>
                    </ul>
                </div>

                <div class="concept-box">
                    <h4>üí° Concepto Clave para Recordar</h4>
                    <p style="font-size: 1.1em;">
                        Los flujos de aprobaci√≥n son como un <strong>"cintur√≥n de seguridad digital"</strong>.
                        No previenen todos los accidentes, pero reducen significativamente el riesgo de
                        errores costosos y te dan una segunda oportunidad para reconsiderar antes de
                        ejecutar algo peligroso.
                    </p>
                </div>

                <div class="example-box">
                    <h4>üöÄ Pr√≥ximos Pasos</h4>
                    <p>Ahora que entiendes los flujos de aprobaci√≥n, puedes:</p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Ejecutar el script: <code>python 025_approval_flows.py</code></li>
                        <li>Modificar los ejemplos para tus necesidades</li>
                        <li>Implementar aprobaciones en tus propias aplicaciones</li>
                        <li>Combinar con otros patrones (workflows, agentes, etc.)</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicializar Mermaid para diagramas
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Asegurar que Prism.js formatee el c√≥digo cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', function() {
            Prism.highlightAll();
        });
    </script>
</body>
</html>
