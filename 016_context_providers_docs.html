<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentaci√≥n: Context Providers - Microsoft Agent Framework</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        h2 {
            color: #764ba2;
            margin-top: 30px;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #764ba2;
            padding-bottom: 10px;
        }

        h3 {
            color: #667eea;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        h4 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .diagram-container {
            background: #f8f4ff;
            border-radius: 8px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid #764ba2;
        }

        .diagram-title {
            text-align: center;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .flow-box {
            background: white;
            border: 3px solid #764ba2;
            border-radius: 8px;
            padding: 20px 30px;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .flow-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .flow-box.provider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .flow-box.agent {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-weight: bold;
        }

        .flow-box.context {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-color: #fcb69f;
        }

        .arrow {
            font-size: 2em;
            color: #764ba2;
            font-weight: bold;
        }

        .arrow-down {
            font-size: 2em;
            color: #764ba2;
            font-weight: bold;
            display: block;
            text-align: center;
            margin: 10px 0;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid #764ba2;
        }

        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.5;
            white-space: pre-wrap;
            display: block;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #856404;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .component-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .component-card:hover {
            border-color: #764ba2;
            box-shadow: 0 4px 16px rgba(118, 75, 162, 0.3);
        }

        .component-card h4 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th {
            background: #764ba2;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #f8f4ff;
        }

        .toc {
            background: #f8f4ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .toc h3 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc li {
            margin-bottom: 10px;
        }

        .toc a {
            color: #764ba2;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .toc a:hover {
            color: #667eea;
            text-decoration: underline;
        }

        .footer {
            background: #2d2d2d;
            color: white;
            padding: 30px;
            text-align: center;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .provider-lifecycle {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .flow-diagram {
                flex-direction: column;
            }

            .arrow {
                transform: rotate(90deg);
            }

            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîÑ Context Providers - Microsoft Agent Framework</h1>
            <p>Documentaci√≥n Completa del Script 016_context_providers.py</p>
        </header>

        <div class="content">
            <!-- Tabla de Contenidos -->
            <div class="toc">
                <h3>üìë Tabla de Contenidos</h3>
                <ul>
                    <li><a href="#introduccion">1. Introducci√≥n</a></li>
                    <li><a href="#conceptos">2. ¬øQu√© es un Context Provider?</a></li>
                    <li><a href="#arquitectura">3. Ciclo de Vida de Context Providers</a></li>
                    <li><a href="#implementaciones">4. Implementaciones Principales (5 Providers)</a></li>
                    <li><a href="#uso">5. C√≥mo Usar Context Providers</a></li>
                    <li><a href="#multiple">6. M√∫ltiples Providers Combinados</a></li>
                    <li><a href="#ventajas">7. Ventajas y Casos de Uso</a></li>
                    <li><a href="#mejores-practicas">8. Mejores Pr√°cticas</a></li>
                </ul>
            </div>

            <!-- 1. Introducci√≥n -->
            <h2 id="introduccion">1. üìñ Introducci√≥n</h2>
            <p>
                El script <span class="highlight">016_context_providers.py</span> demuestra c√≥mo usar
                <strong>Context Providers</strong> en el <strong>Microsoft Agent Framework</strong>.
                Los Context Providers permiten <strong>inyectar contexto din√°mico</strong> a los agentes
                autom√°ticamente antes de cada invocaci√≥n, sin modificar las instrucciones base del agente.
            </p>

            <div class="success-box">
                <strong>üéØ Prop√≥sito Principal:</strong> Separar el contexto din√°mico (que cambia por invocaci√≥n)
                de la l√≥gica est√°tica del agente (instrucciones base), logrando agentes m√°s flexibles y reutilizables.
            </div>

            <div class="info-box">
                <strong>üí° Ejemplo Pr√°ctico:</strong>
                <p>Imagina un agente de atenci√≥n al cliente que necesita saber:</p>
                <ul>
                    <li>üïê La fecha y hora actual (cambia constantemente)</li>
                    <li>üë§ Informaci√≥n del usuario (diferente por cada usuario)</li>
                    <li>üìã Reglas de negocio actuales (horarios, pol√≠ticas)</li>
                    <li>üíæ Historial de la conversaci√≥n (acumulativo)</li>
                </ul>
                <p>
                    En lugar de actualizar manualmente las instrucciones del agente en cada llamada,
                    los Context Providers inyectan esta informaci√≥n <strong>autom√°ticamente</strong>.
                </p>
            </div>

            <!-- Diagrama Principal -->
            <div class="diagram-container">
                <div class="diagram-title">üîÑ Flujo de Context Provider</div>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                    <div class="flow-box">
                        <strong>üë§ Usuario</strong><br>
                        <small>"¬øQu√© d√≠a es hoy?"</small>
                    </div>

                    <span class="arrow-down">‚Üì</span>

                    <div class="flow-box provider">
                        <strong>üîÑ Context Provider</strong><br>
                        <small>invoking() - Inyecta contexto</small>
                    </div>

                    <span class="arrow-down">‚Üì</span>

                    <div class="flow-box context">
                        <strong>üìã Contexto Inyectado</strong><br>
                        <small>Fecha: 2025-12-02<br>Hora: 14:30:00</small>
                    </div>

                    <span class="arrow-down">‚Üì</span>

                    <div class="flow-box agent">
                        <strong>ü§ñ Agente</strong><br>
                        <small>Procesa con contexto</small>
                    </div>

                    <span class="arrow-down">‚Üì</span>

                    <div class="flow-box provider">
                        <strong>‚úÖ Context Provider</strong><br>
                        <small>invoked() - Post-procesamiento</small>
                    </div>

                    <span class="arrow-down">‚Üì</span>

                    <div class="flow-box">
                        <strong>üì§ Respuesta</strong><br>
                        <small>"Hoy es martes 2 de dic de 2025"</small>
                    </div>
                </div>
            </div>

            <!-- 2. Conceptos Clave -->
            <h2 id="conceptos">2. üß† ¬øQu√© es un Context Provider?</h2>

            <p>
                Un <strong>Context Provider</strong> es una clase que implementa dos m√©todos opcionales
                que son llamados autom√°ticamente antes y despu√©s de cada invocaci√≥n del agente:
            </p>

            <div class="component-grid">
                <div class="component-card">
                    <h4>üì• invoking()</h4>
                    <p><strong>Cu√°ndo:</strong> ANTES de cada invocaci√≥n</p>
                    <p><strong>Prop√≥sito:</strong> Inyectar contexto din√°mico</p>
                    <p><strong>Retorna:</strong> <span class="highlight">Context</span> con:</p>
                    <ul>
                        <li><code>instructions</code> - Texto adicional</li>
                        <li><code>messages</code> - Mensajes extras</li>
                        <li><code>tools</code> - Herramientas extras</li>
                    </ul>
                </div>

                <div class="component-card">
                    <h4>üì§ invoked()</h4>
                    <p><strong>Cu√°ndo:</strong> DESPU√âS de cada invocaci√≥n</p>
                    <p><strong>Prop√≥sito:</strong> Post-procesamiento (opcional)</p>
                    <p><strong>Retorna:</strong> <span class="highlight">None</span></p>
                    <p><strong>Uso t√≠pico:</strong></p>
                    <ul>
                        <li>Logging</li>
                        <li>Analytics</li>
                        <li>Actualizar estado</li>
                    </ul>
                </div>
            </div>

            <div class="code-block"><code>from agent_framework import ContextProvider, Context

class MyContextProvider(ContextProvider):
    async def invoking(self, messages: list[dict[str, Any]], **kwargs) -&gt; Context:
        &quot;&quot;&quot;Llamado ANTES de cada invocaci√≥n&quot;&quot;&quot;
        # Preparar contexto din√°mico
        dynamic_context = &quot;Informaci√≥n que cambia por invocaci√≥n...&quot;

        return Context(
            instructions=dynamic_context,
            messages=[],
            tools=[]
        )

    async def invoked(self, messages: list[dict[str, Any]], **kwargs) -&gt; None:
        &quot;&quot;&quot;Llamado DESPU√âS de cada invocaci√≥n (opcional)&quot;&quot;&quot;
        print(&quot;‚úÖ Contexto inyectado exitosamente&quot;)
</code></div>

            <!-- 3. Ciclo de Vida -->
            <h2 id="arquitectura">3. üîÑ Ciclo de Vida de Context Providers</h2>

            <div class="provider-lifecycle">
                <h4 style="color: #764ba2; margin-bottom: 20px; text-align: center;">üìä Secuencia Temporal</h4>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                        <strong>1Ô∏è‚É£ Usuario llama a agent.run("query")</strong>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <strong>2Ô∏è‚É£ Framework llama a provider.invoking()</strong><br>
                        <small>Se inyecta contexto din√°mico en este momento</small>
                    </div>

                    <div style="background: #f8f4ff; padding: 15px; border-radius: 8px; border-left: 4px solid #764ba2;">
                        <strong>3Ô∏è‚É£ Agente recibe mensajes + contexto inyectado</strong><br>
                        <small>El agente ve las instrucciones base + el contexto del provider</small>
                    </div>

                    <div style="background: #f093fb20; padding: 15px; border-radius: 8px; border-left: 4px solid #f5576c;">
                        <strong>4Ô∏è‚É£ Agente procesa y genera respuesta</strong>
                    </div>

                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <strong>5Ô∏è‚É£ Framework llama a provider.invoked()</strong><br>
                        <small>Post-procesamiento, logging, m√©tricas</small>
                    </div>

                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                        <strong>6Ô∏è‚É£ Respuesta retorna al usuario</strong>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Importante:</strong>
                <ul>
                    <li>El contexto inyectado es <strong>temporal</strong> - solo existe para esa invocaci√≥n</li>
                    <li>Las instrucciones base del agente <strong>NO se modifican</strong> permanentemente</li>
                    <li>Cada invocaci√≥n puede recibir contexto diferente</li>
                    <li>M√∫ltiples providers se combinan autom√°ticamente</li>
                </ul>
            </div>

            <!-- 4. Implementaciones -->
            <h2 id="implementaciones">4. üî© Implementaciones Principales (5 Providers)</h2>

            <p>El script demuestra 5 Context Providers diferentes, cada uno con un prop√≥sito espec√≠fico:</p>

            <h3>4.1. DateTimeContextProvider - Contexto Temporal</h3>
            <div class="component-card" style="border-color: #667eea;">
                <p><strong>Prop√≥sito:</strong> Inyectar fecha y hora actual en cada invocaci√≥n</p>
                <p><strong>Utilidad:</strong> El agente siempre tiene contexto temporal actualizado</p>

                <div class="code-block"><code>class DateTimeContextProvider(ContextProvider):
    async def invoking(self, messages, **kwargs) -&gt; Context:
        now = datetime.now()
        temporal_context = f&quot;&quot;&quot;
[CONTEXTO TEMPORAL]
- Fecha actual: {now.strftime('%Y-%m-%d')}
- Hora actual: {now.strftime('%H:%M:%S')}
- D√≠a de la semana: {now.strftime('%A')}
&quot;&quot;&quot;
        return Context(
            instructions=temporal_context,
            messages=[],
            tools=[]
        )
</code></div>

                <div class="success-box">
                    <strong>‚úÖ Ventaja:</strong> El agente puede responder preguntas como "¬øQu√© d√≠a es hoy?"
                    sin que el usuario tenga que pasar la fecha manualmente en cada consulta.
                </div>
            </div>

            <h3>4.2. UserContextProvider - Informaci√≥n del Usuario</h3>
            <div class="component-card" style="border-color: #f5576c;">
                <p><strong>Prop√≥sito:</strong> Inyectar informaci√≥n del usuario actual</p>
                <p><strong>Utilidad:</strong> Personalizar respuestas basadas en el usuario</p>

                <div class="code-block"><code>class UserContextProvider(ContextProvider):
    def __init__(self, user_id: str, user_name: str, user_role: str):
        self.user_id = user_id
        self.user_name = user_name
        self.user_role = user_role

    async def invoking(self, messages, **kwargs) -&gt; Context:
        user_context = f&quot;&quot;&quot;
[INFORMACI√ìN DEL USUARIO]
- ID: {self.user_id}
- Nombre: {self.user_name}
- Rol: {self.user_role}
&quot;&quot;&quot;
        return Context(instructions=user_context, messages=[], tools=[])
</code></div>

                <div class="info-box">
                    <strong>üí° Uso Real:</strong> En producci√≥n, la informaci√≥n vendr√≠a de:
                    <ul>
                        <li>Base de datos</li>
                        <li>Sistema de autenticaci√≥n (JWT, OAuth)</li>
                        <li>Sesi√≥n HTTP/cookies</li>
                        <li>CRM o sistema de usuarios</li>
                    </ul>
                </div>
            </div>

            <h3>4.3. BusinessRulesContextProvider - Reglas de Negocio</h3>
            <div class="component-card" style="border-color: #ffc107;">
                <p><strong>Prop√≥sito:</strong> Inyectar reglas de negocio din√°micas</p>
                <p><strong>Utilidad:</strong> Aplicar pol√≠ticas que cambian (horarios, cuotas, promociones)</p>

                <div class="code-block"><code>class BusinessRulesContextProvider(ContextProvider):
    def __init__(self, business_hours: tuple[int, int] = (9, 18)):
        self.business_hours = business_hours

    async def invoking(self, messages, **kwargs) -&gt; Context:
        current_hour = datetime.now().hour
        is_business_hours = self.business_hours[0] &lt;= current_hour &lt; self.business_hours[1]

        if is_business_hours:
            rules = &quot;‚úÖ DENTRO del horario de atenci√≥n - Procesa solicitudes normalmente&quot;
        else:
            rules = &quot;‚è∞ FUERA del horario - Informa que el servicio est√° cerrado&quot;

        return Context(instructions=rules, messages=[], tools=[])
</code></div>

                <div class="success-box">
                    <strong>‚úÖ Casos de Uso:</strong>
                    <ul>
                        <li>Horarios de atenci√≥n</li>
                        <li>Pol√≠ticas de descuentos temporales</li>
                        <li>L√≠mites de cuota o rate limiting</li>
                        <li>Configuraci√≥n seg√∫n regi√≥n/pa√≠s</li>
                    </ul>
                </div>
            </div>

            <h3>4.4. ConversationMemoryProvider - Memoria de Conversaci√≥n</h3>
            <div class="component-card" style="border-color: #28a745;">
                <p><strong>Prop√≥sito:</strong> Mantener memoria de conversaciones previas</p>
                <p><strong>Utilidad:</strong> Tracking de interacciones, t√≥picos, preferencias</p>

                <div class="code-block"><code>class ConversationMemoryProvider(ContextProvider):
    def __init__(self):
        self.conversation_count = 0
        self.topics_discussed = []

    async def invoking(self, messages, **kwargs) -&gt; Context:
        self.conversation_count += 1

        memory_context = f&quot;&quot;&quot;
[MEMORIA DE CONVERSACI√ìN]
- N√∫mero de interacciones: {self.conversation_count}
- T√≥picos discutidos: {len(self.topics_discussed)}
&quot;&quot;&quot;
        return Context(instructions=memory_context, messages=[], tools=[])
</code></div>

                <div class="info-box">
                    <strong>üí° Nota:</strong> Este provider tiene <strong>estado mutable</strong> que se
                    actualiza en cada invocaci√≥n. √ötil para tracking y analytics.
                </div>
            </div>

            <h3>4.5. DynamicPricingContextProvider - Estado Din√°mico</h3>
            <div class="component-card" style="border-color: #9c27b0;">
                <p><strong>Prop√≥sito:</strong> Contexto que cambia externamente (pricing din√°mico)</p>
                <p><strong>Utilidad:</strong> Adaptar comportamiento basado en estado externo</p>

                <div class="code-block"><code>class DynamicPricingContextProvider(ContextProvider):
    def __init__(self):
        self.demand_level = &quot;normal&quot;
        self.discount_rate = 0.0

    def update_demand(self, level: str):
        &quot;&quot;&quot;M√©todo p√∫blico para cambiar estado&quot;&quot;&quot;
        self.demand_level = level
        if level == &quot;low&quot;:
            self.discount_rate = 0.20  # 20% descuento
        elif level == &quot;high&quot;:
            self.discount_rate = -0.10  # 10% aumento

    async def invoking(self, messages, **kwargs) -&gt; Context:
        pricing_context = f&quot;&quot;&quot;
[PRICING DIN√ÅMICO]
- Nivel de demanda: {self.demand_level}
- Ajuste de precio: {self.discount_rate:+.0%}
&quot;&quot;&quot;
        return Context(instructions=pricing_context, messages=[], tools=[])
</code></div>

                <div class="success-box">
                    <strong>‚úÖ Ventaja Clave:</strong> Puedes actualizar el estado del provider
                    (<code>update_demand()</code>) en cualquier momento, y el agente autom√°ticamente
                    ver√° el nuevo contexto en la pr√≥xima invocaci√≥n.
                </div>
            </div>

            <!-- 5. C√≥mo Usar -->
            <h2 id="uso">5. üöÄ C√≥mo Usar Context Providers</h2>

            <h3>5.1. Agente con UN Context Provider</h3>

            <div class="code-block"><code># 1. Crear el provider
datetime_provider = DateTimeContextProvider()

# 2. Crear agente CON el provider
agent = client.create_agent(
    name=&quot;Time-Aware Assistant&quot;,
    instructions=&quot;Eres un asistente consciente del tiempo&quot;,
    context_providers=[datetime_provider]  # ‚Üê Inyecci√≥n autom√°tica
)

# 3. Usar el agente normalmente
response = await agent.run(&quot;¬øQu√© d√≠a es hoy?&quot;)
# El agente recibe autom√°ticamente el contexto temporal
</code></div>

            <div class="info-box">
                <strong>üí° Nota:</strong> No necesitas hacer nada especial al llamar <code>agent.run()</code>.
                El framework se encarga autom√°ticamente de llamar a <code>provider.invoking()</code> antes
                de procesar la consulta.
            </div>

            <!-- 6. M√∫ltiples Providers -->
            <h2 id="multiple">6. üîó M√∫ltiples Providers Combinados</h2>

            <p>
                Una de las caracter√≠sticas m√°s poderosas es que puedes usar <strong>m√∫ltiples providers simult√°neamente</strong>.
                El framework los combina autom√°ticamente.
            </p>

            <div class="diagram-container">
                <div class="diagram-title">üîÑ Flujo con M√∫ltiples Providers</div>
                <div style="text-align: center;">
                    <div class="flow-box">üë§ Usuario Query</div>
                    <span class="arrow-down">‚Üì</span>

                    <div style="background: #f8f4ff; padding: 20px; border-radius: 8px; border: 2px dashed #764ba2; margin: 20px 0;">
                        <strong style="color: #764ba2;">Framework ejecuta providers en orden:</strong>
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #667eea;">
                                1Ô∏è‚É£ DateTimeContextProvider ‚Üí Contexto temporal
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #f5576c;">
                                2Ô∏è‚É£ UserContextProvider ‚Üí Info del usuario
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #ffc107;">
                                3Ô∏è‚É£ BusinessRulesContextProvider ‚Üí Reglas de negocio
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #28a745;">
                                4Ô∏è‚É£ ConversationMemoryProvider ‚Üí Memoria
                            </div>
                        </div>
                    </div>

                    <span class="arrow-down">‚Üì</span>
                    <div class="flow-box context">
                        <strong>üìã Contexto Combinado</strong><br>
                        <small>Todos los contextos fusionados</small>
                    </div>
                    <span class="arrow-down">‚Üì</span>
                    <div class="flow-box agent">ü§ñ Agente Procesa</div>
                </div>
            </div>

            <div class="code-block"><code># Crear m√∫ltiples providers
datetime_provider = DateTimeContextProvider()
user_provider = UserContextProvider(&quot;user_123&quot;, &quot;Mar√≠a Garc√≠a&quot;, &quot;Premium&quot;)
business_provider = BusinessRulesContextProvider((9, 18))
memory_provider = ConversationMemoryProvider()

# Crear agente con TODOS los providers
agent = client.create_agent(
    name=&quot;Contextual Assistant&quot;,
    instructions=&quot;Eres un asistente altamente contextual&quot;,
    context_providers=[
        datetime_provider,
        user_provider,
        business_provider,
        memory_provider
    ]  # ‚Üê Se combinan autom√°ticamente
)

# El agente recibe contexto de TODOS los providers en cada invocaci√≥n
response = await agent.run(&quot;Ay√∫dame con mi cuenta&quot;)
</code></div>

            <div class="success-box">
                <strong>‚úÖ Resultado:</strong> El agente recibe un contexto completo que incluye:
                <ul>
                    <li>üìÖ Fecha y hora actual</li>
                    <li>üë§ Nombre y rol del usuario: "Mar√≠a Garc√≠a" (Premium)</li>
                    <li>üè¢ Estado del horario de atenci√≥n</li>
                    <li>üíæ N√∫mero de interacciones previas</li>
                </ul>
                <p>Todo esto sin modificar las instrucciones base del agente.</p>
            </div>

            <!-- 7. Ventajas -->
            <h2 id="ventajas">7. üéØ Ventajas y Casos de Uso</h2>

            <h3>7.1. Ventajas Principales</h3>

            <div class="component-grid">
                <div class="component-card">
                    <h4>‚úÖ Separaci√≥n de Concerns</h4>
                    <p>El contexto din√°mico est√° separado de la l√≥gica est√°tica del agente.</p>
                    <p>M√°s f√°cil de mantener y testear.</p>
                </div>

                <div class="component-card">
                    <h4>üîÑ Reutilizable</h4>
                    <p>Un provider puede ser usado en m√∫ltiples agentes diferentes.</p>
                    <p>DRY (Don't Repeat Yourself).</p>
                </div>

                <div class="component-card">
                    <h4>üß© Composable</h4>
                    <p>M√∫ltiples providers se combinan autom√°ticamente.</p>
                    <p>Mix and match seg√∫n necesidades.</p>
                </div>

                <div class="component-card">
                    <h4>‚ö° Din√°mico</h4>
                    <p>El contexto puede cambiar en cada invocaci√≥n.</p>
                    <p>No necesitas recrear el agente.</p>
                </div>

                <div class="component-card">
                    <h4>üß™ Testeable</h4>
                    <p>Los providers son clases independientes.</p>
                    <p>F√°ciles de testear aisladamente.</p>
                </div>

                <div class="component-card">
                    <h4>üìä Observable</h4>
                    <p>El m√©todo <code>invoked()</code> permite logging/metrics.</p>
                    <p>Visibilidad del comportamiento.</p>
                </div>
            </div>

            <h3>7.2. Casos de Uso en Producci√≥n</h3>

            <table>
                <thead>
                    <tr>
                        <th>Caso de Uso</th>
                        <th>Provider Apropiado</th>
                        <th>Ejemplo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Informaci√≥n del usuario</td>
                        <td>UserContextProvider</td>
                        <td>Personalizaci√≥n, permisos, preferencias</td>
                    </tr>
                    <tr>
                        <td>Contexto temporal</td>
                        <td>DateTimeContextProvider</td>
                        <td>Recordatorios, scheduling, zonas horarias</td>
                    </tr>
                    <tr>
                        <td>Reglas de negocio</td>
                        <td>BusinessRulesContextProvider</td>
                        <td>Horarios, pol√≠ticas, l√≠mites, cuotas</td>
                    </tr>
                    <tr>
                        <td>Datos externos</td>
                        <td>DatabaseContextProvider</td>
                        <td>CRM, inventario, estado de sistemas</td>
                    </tr>
                    <tr>
                        <td>Estado de sesi√≥n</td>
                        <td>SessionContextProvider</td>
                        <td>Carrito de compras, progreso, workflow</td>
                    </tr>
                    <tr>
                        <td>Personalizaci√≥n</td>
                        <td>HistoryContextProvider</td>
                        <td>Comportamiento pasado, preferencias aprendidas</td>
                    </tr>
                </tbody>
            </table>

            <!-- 8. Mejores Pr√°cticas -->
            <h2 id="mejores-practicas">8. ‚ú® Mejores Pr√°cticas</h2>

            <h3>8.1. Dise√±o de Context Providers</h3>

            <div class="warning-box">
                <strong>‚ö†Ô∏è DO's:</strong>
                <ul>
                    <li>‚úÖ Mant√©n los providers <strong>peque√±os y enfocados</strong> (single responsibility)</li>
                    <li>‚úÖ Usa providers para <strong>contexto que cambia frecuentemente</strong></li>
                    <li>‚úÖ Nombra los providers descriptivamente (<code>DateTimeContextProvider</code> mejor que <code>Provider1</code>)</li>
                    <li>‚úÖ Documenta claramente qu√© contexto inyecta cada provider</li>
                    <li>‚úÖ Considera el <strong>costo de tokens</strong> del contexto inyectado</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>‚ùå DON'Ts:</strong>
                <ul>
                    <li>‚ùå NO uses providers para contexto est√°tico (ponlo en instrucciones base)</li>
                    <li>‚ùå NO inyectes contexto excesivamente largo (consume tokens)</li>
                    <li>‚ùå NO hagas operaciones pesadas en <code>invoking()</code> (bloquea la invocaci√≥n)</li>
                    <li>‚ùå NO compartas estado mutable entre agentes sin sincronizaci√≥n</li>
                </ul>
            </div>

            <h3>8.2. Performance y Optimizaci√≥n</h3>

            <div class="info-box">
                <strong>üí° Tips de Performance:</strong>
                <ul>
                    <li>
                        <strong>Cache cuando sea posible:</strong> Si el contexto es costoso de calcular,
                        considera cachear resultados con TTL.
                    </li>
                    <li>
                        <strong>Lazy loading:</strong> Solo carga datos cuando sean realmente necesarios.
                    </li>
                    <li>
                        <strong>Async I/O:</strong> Si necesitas datos externos, usa operaciones async para
                        no bloquear.
                    </li>
                    <li>
                        <strong>Tama√±o del contexto:</strong> Monitorea el tama√±o del contexto inyectado -
                        afecta costos y latencia.
                    </li>
                </ul>
            </div>

            <h3>8.3. Testing</h3>

            <div class="code-block"><code># Ejemplo de test para un Context Provider
import pytest

@pytest.mark.asyncio
async def test_datetime_provider():
    # Arrange
    provider = DateTimeContextProvider()

    # Act
    context = await provider.invoking(messages=[], **{})

    # Assert
    assert &quot;CONTEXTO TEMPORAL&quot; in context.instructions
    assert &quot;Fecha actual&quot; in context.instructions
    assert len(context.messages) == 0
    assert len(context.tools) == 0
</code></div>

            <!-- Resumen Final -->
            <h2>üéØ Resumen Final</h2>

            <div class="success-box">
                <h3 style="margin-top: 0;">Conceptos Clave Aprendidos:</h3>
                <ol>
                    <li><strong>Context Providers</strong> inyectan contexto din√°mico autom√°ticamente</li>
                    <li><strong>invoking()</strong> se llama ANTES de cada invocaci√≥n (inyecci√≥n)</li>
                    <li><strong>invoked()</strong> se llama DESPU√âS de cada invocaci√≥n (post-procesamiento)</li>
                    <li><strong>M√∫ltiples providers</strong> se pueden combinar en un solo agente</li>
                    <li><strong>5 implementaciones</strong>: DateTime, User, BusinessRules, Memory, DynamicPricing</li>
                    <li><strong>Separaci√≥n de concerns</strong>: contexto din√°mico vs l√≥gica est√°tica</li>
                    <li><strong>Reutilizable y testeable</strong>: providers son clases independientes</li>
                </ol>
            </div>

            <div class="info-box">
                <h3 style="margin-top: 0;">Pr√≥ximos Pasos Sugeridos:</h3>
                <ul>
                    <li>üõ†Ô∏è Implementar <strong>Middleware</strong> para interceptar y modificar comportamiento</li>
                    <li>üìä Agregar <strong>Observabilidad y Telemetr√≠a</strong> para monitoreo</li>
                    <li>üîÄ Crear <strong>Context Providers personalizados</strong> para tu caso de uso</li>
                    <li>üíæ Integrar con bases de datos para <strong>contexto persistente</strong></li>
                    <li>üîê Agregar <strong>AuthContextProvider</strong> para permisos y seguridad</li>
                    <li>üåç Implementar <strong>LocaleContextProvider</strong> para internacionalizaci√≥n</li>
                </ul>
            </div>

            <!-- Tabla de Referencia -->
            <h2>üìö Referencia R√°pida</h2>
            <table>
                <thead>
                    <tr>
                        <th>Concepto</th>
                        <th>Descripci√≥n</th>
                        <th>C√≥digo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Crear Provider</strong></td>
                        <td>Heredar de ContextProvider</td>
                        <td><code>class MyProvider(ContextProvider):</code></td>
                    </tr>
                    <tr>
                        <td><strong>M√©todo de inyecci√≥n</strong></td>
                        <td>Implementar invoking()</td>
                        <td><code>async def invoking(...) -> Context:</code></td>
                    </tr>
                    <tr>
                        <td><strong>Retornar contexto</strong></td>
                        <td>Crear objeto Context</td>
                        <td><code>return Context(instructions=..., messages=[], tools=[])</code></td>
                    </tr>
                    <tr>
                        <td><strong>Usar provider</strong></td>
                        <td>Pasarlo al crear agente</td>
                        <td><code>context_providers=[provider1, provider2]</code></td>
                    </tr>
                    <tr>
                        <td><strong>Post-procesamiento</strong></td>
                        <td>Implementar invoked() (opcional)</td>
                        <td><code>async def invoked(...) -> None:</code></td>
                    </tr>
                    <tr>
                        <td><strong>Estado mutable</strong></td>
                        <td>Variables de instancia</td>
                        <td><code>self.count += 1</code></td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box" style="margin-top: 30px;">
                <strong>‚ö†Ô∏è Recordatorio Importante:</strong>
                <p>Los Context Providers son para <strong>contexto din√°mico</strong> que cambia frecuentemente.
                Para contexto est√°tico que no cambia, incl√∫yelo directamente en las <code>instructions</code>
                del agente.</p>
            </div>
        </div>

        <div class="footer">
            <h3>üîÑ Documentaci√≥n de Context Providers</h3>
            <p>Script: <strong>016_context_providers.py</strong></p>
            <p>Microsoft Agent Framework + Azure AI Foundry</p>
            <p>5 Providers | Inyecci√≥n Autom√°tica | Composable</p>
            <p style="margin-top: 15px; opacity: 0.8;">
                Generado autom√°ticamente | ¬© 2025
            </p>
        </div>
    </div>
</body>
</html>
